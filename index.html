<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>ArchivesPortail</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Josefin+Sans:wght@300;400;600&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --gold:#c9a84c;--gold-light:#e8c97a;--bg:#0f0d0a;--bg2:#1a1710;
      --bg3:#241f18;--ink:#f0e8d8;--ink-muted:#a89880;--ink-faint:#5a5040;
      --border:rgba(201,168,76,0.2);--border-strong:rgba(201,168,76,0.5);
      --green:#4caf82;--red:#c94c4c;--blue:#4c8ecf;
    }
    html,body{height:100%;background:var(--bg);color:var(--ink);font-family:'Josefin Sans',sans-serif;font-weight:300;overflow:hidden}
    #app{display:grid;grid-template-rows:auto 1fr;height:100vh}

    /* â”€â”€ HEADER â”€â”€ */
    header{background:var(--bg2);border-bottom:1px solid var(--border-strong);padding:0 16px;display:flex;align-items:center;gap:12px;height:56px;z-index:100;box-shadow:0 4px 24px rgba(0,0,0,.6)}
    .logo{display:flex;align-items:center;gap:8px;flex-shrink:0;cursor:pointer}
    .logo-icon{width:28px;height:28px;background:var(--gold);clip-path:polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%)}
    .logo-text{font-family:'Cormorant Garamond',serif;font-size:1.1rem;font-weight:600;color:var(--gold);letter-spacing:.08em;line-height:1.1}
    .logo-sub{font-size:.52rem;color:var(--ink-muted);letter-spacing:.18em;text-transform:uppercase}
    .search-wrap{flex:1;max-width:500px;position:relative;min-width:0}
    .search-wrap input{width:100%;background:var(--bg3);border:1px solid var(--border-strong);color:var(--ink);font-family:'Josefin Sans',sans-serif;font-size:.82rem;padding:8px 38px 8px 13px;border-radius:4px;outline:none;transition:border-color .2s,box-shadow .2s}
    .search-wrap input::placeholder{color:var(--ink-faint)}
    .search-wrap input:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,.1)}
    .sbtn{position:absolute;right:7px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--gold);cursor:pointer;padding:3px;display:flex;opacity:.8;transition:opacity .2s}
    .sbtn:hover{opacity:1}
    .header-filters{display:flex;gap:4px;flex-shrink:0;flex-wrap:nowrap}
    .filter-btn{background:transparent;border:1px solid var(--border);color:var(--ink-muted);font-family:'Josefin Sans',sans-serif;font-size:.62rem;font-weight:400;letter-spacing:.1em;text-transform:uppercase;padding:4px 8px;border-radius:2px;cursor:pointer;transition:all .18s;white-space:nowrap}
    .filter-btn:hover{border-color:var(--gold);color:var(--gold-light)}
    .filter-btn.active{background:var(--gold);border-color:var(--gold);color:var(--bg);font-weight:600}
    .filter-btn.free-btn{border-color:var(--blue);color:var(--blue)}
    .filter-btn.free-btn.active{background:var(--blue);border-color:var(--blue);color:#fff}
    .hbtn{background:none;border:1px solid var(--border-strong);color:var(--gold);font-family:'Josefin Sans',sans-serif;font-size:.62rem;letter-spacing:.1em;padding:4px 10px;border-radius:2px;cursor:pointer;transition:all .18s;white-space:nowrap;flex-shrink:0}
    .hbtn:hover{background:var(--gold);color:var(--bg)}

    /* â”€â”€ LAYOUT â”€â”€ */
    main{display:grid;grid-template-columns:220px 1fr;overflow:hidden}

    /* â”€â”€ SIDEBAR â”€â”€ */
    #sidebar{background:var(--bg2);border-right:1px solid var(--border);overflow-y:auto;padding:12px 0}
    #sidebar::-webkit-scrollbar{width:4px}
    #sidebar::-webkit-scrollbar-thumb{background:var(--border-strong);border-radius:2px}
    .sb-section{margin-bottom:16px}
    .sb-title{font-size:.55rem;font-weight:600;letter-spacing:.25em;text-transform:uppercase;color:var(--gold);padding:0 12px 5px;border-bottom:1px solid var(--border);margin-bottom:4px}
    .sb-link{display:flex;align-items:center;gap:7px;padding:6px 12px;color:var(--ink-muted);font-size:.72rem;transition:all .15s;border-left:2px solid transparent;cursor:pointer}
    .sb-link:hover{color:var(--ink);background:rgba(201,168,76,.06);border-left-color:var(--gold)}

    /* â”€â”€ CONTENT â”€â”€ */
    #content{overflow:hidden;display:flex;flex-direction:column}

    /* â”€â”€ HOME â”€â”€ */
    #home-screen{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:22px;padding:28px;background:var(--bg);position:relative;overflow:auto}
    #home-screen::before{content:'';position:absolute;inset:0;pointer-events:none;background-image:linear-gradient(rgba(201,168,76,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(201,168,76,.03) 1px,transparent 1px);background-size:40px 40px}
    .home-top{display:flex;flex-direction:column;align-items:center;gap:4px;animation:fadeUp .5s ease both;position:relative}
    .orn{display:flex;align-items:center;gap:10px;color:var(--gold)}
    .orn::before{content:'';width:50px;height:1px;background:linear-gradient(90deg,transparent,var(--gold))}
    .orn::after{content:'';width:50px;height:1px;background:linear-gradient(90deg,var(--gold),transparent)}
    .home-title{font-family:'Cormorant Garamond',serif;font-size:clamp(1.6rem,3vw,2.7rem);font-weight:300;color:var(--ink);letter-spacing:.08em;text-align:center;line-height:1.15}
    .home-title em{font-style:italic;color:var(--gold-light)}
    .home-sub{font-size:.6rem;letter-spacing:.26em;text-transform:uppercase;color:var(--ink-muted);text-align:center}

    .home-search-wrap{width:100%;max-width:520px;position:relative;animation:fadeUp .5s .1s ease both;opacity:0;animation-fill-mode:forwards}
    .home-search-wrap input{width:100%;background:var(--bg2);border:1px solid var(--border-strong);border-radius:3px;color:var(--ink);font-family:'Cormorant Garamond',serif;font-size:1.05rem;font-weight:300;letter-spacing:.04em;padding:12px 48px 12px 16px;outline:none;transition:border-color .2s,box-shadow .2s}
    .home-search-wrap input::placeholder{color:var(--ink-faint);font-style:italic}
    .home-search-wrap input:focus{border-color:var(--gold);box-shadow:0 0 0 4px rgba(201,168,76,.08)}
    .home-sbtn{position:absolute;right:9px;top:50%;transform:translateY(-50%);background:var(--gold);border:none;border-radius:2px;color:var(--bg);cursor:pointer;padding:7px 9px;display:flex;transition:background .15s}
    .home-sbtn:hover{background:var(--gold-light)}

    .home-filters{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;max-width:520px;animation:fadeUp .5s .18s ease both;opacity:0;animation-fill-mode:forwards}
    .filter-info{font-size:.66rem;color:var(--ink-muted);background:var(--bg2);border:1px solid var(--border);border-radius:3px;padding:6px 14px;max-width:520px;text-align:center;animation:fadeUp .5s .22s ease both;opacity:0;animation-fill-mode:forwards}
    .filter-info strong{color:var(--gold)}

    .quick-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:7px;width:100%;max-width:540px;animation:fadeUp .5s .28s ease both;opacity:0;animation-fill-mode:forwards}
    .qcard{background:var(--bg2);border:1px solid var(--border);border-radius:4px;padding:9px 5px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:5px;transition:all .18s}
    .qcard:hover{border-color:var(--gold);background:var(--bg3);transform:translateY(-2px);box-shadow:0 5px 18px rgba(0,0,0,.4)}
    .qcard-icon{font-size:1.2rem}
    .qcard-name{font-size:.57rem;letter-spacing:.08em;text-transform:uppercase;color:var(--ink-muted);text-align:center;line-height:1.3}

    /* â”€â”€ RESULTS PANEL â”€â”€ */
    #results-panel{flex:1;overflow-y:auto;padding:0;display:none;flex-direction:column}
    #results-panel.show{display:flex}
    #results-panel::-webkit-scrollbar{width:5px}
    #results-panel::-webkit-scrollbar-thumb{background:var(--border-strong);border-radius:3px}

    /* Info card */
    #info-card{background:var(--bg2);border-bottom:1px solid var(--border);padding:20px 24px;display:none;gap:20px;align-items:flex-start}
    #info-card.show{display:flex}
    #info-card-img{width:90px;height:110px;object-fit:cover;border-radius:3px;border:1px solid var(--border-strong);flex-shrink:0;background:var(--bg3)}
    #info-card-img.placeholder{display:flex;align-items:center;justify-content:center;font-size:2.5rem}
    .info-card-body{flex:1;min-width:0}
    .info-card-title{font-family:'Cormorant Garamond',serif;font-size:1.4rem;font-weight:600;color:var(--ink);letter-spacing:.06em;margin-bottom:4px}
    .info-card-meta{font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:var(--gold);margin-bottom:8px}
    .info-card-desc{font-size:.78rem;color:var(--ink-muted);line-height:1.7;letter-spacing:.03em;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden}
    .info-card-link{font-size:.65rem;letter-spacing:.08em;color:var(--gold);cursor:pointer;margin-top:6px;display:inline-block;border-bottom:1px solid transparent;transition:border-color .15s}
    .info-card-link:hover{border-bottom-color:var(--gold)}
    .info-loading{font-size:.72rem;color:var(--ink-faint);letter-spacing:.08em;padding:12px 0;display:none}
    .info-loading.show{display:block}

    /* Results list */
    #results-list{padding:16px 20px;display:flex;flex-direction:column;gap:8px}
    .results-section-title{font-size:.6rem;font-weight:600;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);padding:12px 0 6px;border-bottom:1px solid var(--border);margin-bottom:4px}
    .result-card{background:var(--bg2);border:1px solid var(--border);border-radius:4px;padding:12px 16px;cursor:pointer;transition:all .18s;display:flex;align-items:flex-start;gap:12px}
    .result-card:hover{border-color:var(--gold);background:var(--bg3);transform:translateX(3px)}
    .result-card-icon{font-size:1.3rem;flex-shrink:0;margin-top:2px}
    .result-card-body{flex:1;min-width:0}
    .result-card-title{font-size:.82rem;font-weight:600;color:var(--ink);letter-spacing:.04em;margin-bottom:3px}
    .result-card-url{font-size:.62rem;color:var(--gold);letter-spacing:.06em;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .result-card-desc{font-size:.72rem;color:var(--ink-muted);letter-spacing:.03em;line-height:1.6}
    .result-card-actions{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap}
    .raction{background:none;border:1px solid var(--border);color:var(--ink-muted);font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.08em;padding:4px 10px;border-radius:2px;cursor:pointer;transition:all .15s;white-space:nowrap}
    .raction:hover{border-color:var(--gold);color:var(--gold)}
    .raction.primary{background:var(--gold);border-color:var(--gold);color:var(--bg);font-weight:600}
    .raction.primary:hover{background:var(--gold-light)}

    /* â”€â”€ VIEWER â”€â”€ */
    #viewer-wrap{display:none;flex-direction:column;flex:1;overflow:hidden}
    #viewer-wrap.active{display:flex}
    .viewer-bar{background:var(--bg2);border-bottom:1px solid var(--border);padding:6px 12px;display:flex;align-items:center;gap:8px;flex-shrink:0}
    .viewer-url{flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:3px;padding:4px 9px;font-size:.65rem;color:var(--ink-muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .vbtn{background:none;border:1px solid var(--border);color:var(--ink-muted);font-family:'Josefin Sans',sans-serif;font-size:.64rem;letter-spacing:.1em;padding:4px 9px;border-radius:2px;cursor:pointer;transition:all .15s;white-space:nowrap}
    .vbtn:hover{border-color:var(--gold);color:var(--gold)}
    #viewer-area{flex:1;position:relative;overflow:hidden}
    #viewer{width:100%;height:100%;border:none;background:#fff;display:block}

    /* fallback in viewer */
    #viewer-fallback{display:none;position:absolute;inset:0;background:var(--bg);flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:40px;text-align:center;z-index:10}
    #viewer-fallback.show{display:flex}
    #viewer-fallback h3{font-family:'Cormorant Garamond',serif;font-size:1.4rem;font-weight:400;color:var(--ink)}
    #viewer-fallback p{font-size:.74rem;color:var(--ink-muted);max-width:380px;line-height:1.8}
    .fb-actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:6px}
    .fb-btn{background:var(--gold);border:none;color:var(--bg);font-family:'Josefin Sans',sans-serif;font-size:.75rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;padding:10px 20px;border-radius:3px;cursor:pointer;transition:background .15s}
    .fb-btn:hover{background:var(--gold-light)}
    .fb-btn.secondary{background:none;border:1px solid var(--border-strong);color:var(--ink-muted)}
    .fb-btn.secondary:hover{border-color:var(--gold);color:var(--gold);background:none}

    /* toast */
    .toast{position:fixed;bottom:18px;right:18px;background:var(--bg3);border:1px solid var(--border-strong);color:var(--ink);font-size:.72rem;letter-spacing:.06em;padding:9px 16px;border-radius:4px;z-index:9999;opacity:0;transform:translateY(8px);transition:all .3s;pointer-events:none}
    .toast.show{opacity:1;transform:translateY(0)}

    #ad-container{display:none}
    ::-webkit-scrollbar{width:5px}
    ::-webkit-scrollbar-track{background:var(--bg)}
    ::-webkit-scrollbar-thumb{background:var(--border-strong);border-radius:3px}
    @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
    @keyframes spin{to{transform:rotate(360deg)}}
    .spinner{width:18px;height:18px;border:2px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite;display:inline-block;vertical-align:middle;margin-right:8px}
    @media(max-width:760px){main{grid-template-columns:1fr}#sidebar{display:none}.header-filters{display:none}.quick-grid{grid-template-columns:repeat(3,1fr)}}
  </style>
</head>
<body>
<div id="app">

  <!-- â•â• HEADER â•â• -->
  <header>
    <div class="logo" onclick="goHome()">
      <div class="logo-icon"></div>
      <div>
        <div class="logo-text">ArchivesPortail</div>
        <div class="logo-sub">Navigateur Historique</div>
      </div>
    </div>
    <div class="search-wrap">
      <input type="text" id="header-search" placeholder="Rechercherâ€¦"
        onkeydown="if(event.key==='Enter') doSearch(this.value)"/>
      <button class="sbtn" onclick="doSearch(document.getElementById('header-search').value)">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      </button>
    </div>
    <div class="header-filters">
      <button class="filter-btn free-btn active" data-filter="free" onclick="setFilter('free',this)">ğŸŒ Libre</button>
      <button class="filter-btn" data-filter="genealogy"    onclick="setFilter('genealogy',this)">ğŸŒ³ GÃ©nÃ©alogie</button>
      <button class="filter-btn" data-filter="royal"        onclick="setFilter('royal',this)">ğŸ‘‘ Royales</button>
      <button class="filter-btn" data-filter="buildings"    onclick="setFilter('buildings',this)">ğŸ›ï¸ BÃ¢timents</button>
      <button class="filter-btn" data-filter="history"      onclick="setFilter('history',this)">ğŸ“œ Histoire</button>
      <button class="filter-btn" data-filter="institutions" onclick="setFilter('institutions',this)">âš–ï¸ Institutions</button>
    </div>
    <button class="hbtn" onclick="downloadApp()">â¬‡ App</button>
  </header>

  <main>
    <!-- â•â• SIDEBAR â•â• -->
    <aside id="sidebar">
      <div class="sb-section">
        <div class="sb-title">Recherche Libre</div>
        <div class="sb-link" onclick="setFilter('free',null);document.getElementById('home-search').focus()">ğŸŒ Recherche gÃ©nÃ©rale</div>
      </div>
      <div class="sb-section">
        <div class="sb-title">GÃ©nÃ©alogie</div>
        <div class="sb-link" onclick="quickOpen('https://www.geneanet.org','Geneanet')">ğŸŒ³ Geneanet</div>
        <div class="sb-link" onclick="quickOpen('https://www.familysearch.org/fr/','FamilySearch')">ğŸ” FamilySearch</div>
        <div class="sb-link" onclick="quickOpen('https://roglo.eu','Roglo')">ğŸ° Roglo</div>
        <div class="sb-link" onclick="quickOpen('https://www.geneall.net/fr/','Geneall')">ğŸ”° Geneall</div>
        <div class="sb-link" onclick="quickOpen('https://www.filae.com','Filae')">ğŸ“œ Filae</div>
      </div>
      <div class="sb-section">
        <div class="sb-title">Familles Royales</div>
        <div class="sb-link" onclick="quickOpen('https://roglo.eu','Roglo Royales')">ğŸ‘‘ Roglo</div>
        <div class="sb-link" onclick="quickOpen('https://fr.wikipedia.org/wiki/Liste_des_monarques_de_France','Rois de France')">ğŸ“– Rois de France</div>
        <div class="sb-link" onclick="quickOpen('https://www.geneall.net/fr/','Geneall')">ğŸ–ï¸ Geneall</div>
      </div>
      <div class="sb-section">
        <div class="sb-title">BÃ¢timents</div>
        <div class="sb-link" onclick="quickOpen('https://monumentum.fr','Monumentum')">ğŸ—¿ Monumentum</div>
        <div class="sb-link" onclick="quickOpen('https://www.pop.culture.gouv.fr','Patrimoine Ouvert')">ğŸ›ï¸ Patrimoine Ouvert</div>
        <div class="sb-link" onclick="quickOpen('https://fr.wikipedia.org/wiki/Portail:Ch%C3%A2teaux_de_France','ChÃ¢teaux')">ğŸ° ChÃ¢teaux France</div>
      </div>
      <div class="sb-section">
        <div class="sb-title">Histoire</div>
        <div class="sb-link" onclick="quickOpen('https://gallica.bnf.fr','Gallica')">ğŸ“š Gallica BnF</div>
        <div class="sb-link" onclick="quickOpen('https://www.persee.fr','PersÃ©e')">ğŸ“ PersÃ©e</div>
        <div class="sb-link" onclick="quickOpen('https://www.archives-nationales.culture.gouv.fr','Archives Nat.')">ğŸ“ Archives Nationales</div>
        <div class="sb-link" onclick="quickOpen('https://www.retronews.fr','RetroNews')">ğŸ—ï¸ RetroNews</div>
        <div class="sb-link" onclick="quickOpen('https://histoire-image.org','Histoire-Image')">ğŸ–¼ï¸ Histoire-Image</div>
      </div>
      <div class="sb-section">
        <div class="sb-title">Institutions</div>
        <div class="sb-link" onclick="quickOpen('https://www.assemblee-nationale.fr','AssemblÃ©e Nat.')">ğŸ›ï¸ AssemblÃ©e Nationale</div>
        <div class="sb-link" onclick="quickOpen('https://www.senat.fr','SÃ©nat')">âš–ï¸ SÃ©nat</div>
        <div class="sb-link" onclick="quickOpen('https://www.elysee.fr','Ã‰lysÃ©e')">ğŸ‡«ğŸ‡· Ã‰lysÃ©e</div>
      </div>
    </aside>

    <div id="content">

      <!-- â•â• HOME â•â• -->
      <div id="home-screen">
        <div class="home-top">
          <div class="orn">âœ¦</div>
          <h1 class="home-title">Explorez les <em>Archives</em><br>de l'Histoire</h1>
          <p class="home-sub">GÃ©nÃ©alogie Â· Patrimoine Â· Histoire Â· Institutions</p>
        </div>
        <div class="home-search-wrap">
          <input type="text" id="home-search"
            placeholder="Ex : Louis XIV, chÃ¢teau de Versailles, NapolÃ©onâ€¦"
            onkeydown="if(event.key==='Enter') doSearch(this.value)"/>
          <button class="home-sbtn" onclick="doSearch(document.getElementById('home-search').value)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          </button>
        </div>
        <div class="home-filters">
          <button class="filter-btn free-btn active" data-filter="free" onclick="setFilter('free',this)">ğŸŒ Recherche Libre</button>
          <button class="filter-btn" data-filter="genealogy"    onclick="setFilter('genealogy',this)">ğŸŒ³ GÃ©nÃ©alogie</button>
          <button class="filter-btn" data-filter="royal"        onclick="setFilter('royal',this)">ğŸ‘‘ Familles Royales</button>
          <button class="filter-btn" data-filter="buildings"    onclick="setFilter('buildings',this)">ğŸ›ï¸ BÃ¢timents</button>
          <button class="filter-btn" data-filter="history"      onclick="setFilter('history',this)">ğŸ“œ Histoire</button>
          <button class="filter-btn" data-filter="institutions" onclick="setFilter('institutions',this)">âš–ï¸ Institutions</button>
        </div>
        <div class="filter-info">
          <strong id="filter-label-home">ğŸŒ Recherche Libre</strong>
          â€” <span id="filter-desc-home">Recherche sur tous les sites, rÃ©sultats directs avec description</span>
        </div>
        <div class="quick-grid">
          <div class="qcard" onclick="quickOpen('https://www.geneanet.org','Geneanet')"><span class="qcard-icon">ğŸŒ³</span><span class="qcard-name">Geneanet</span></div>
          <div class="qcard" onclick="quickOpen('https://gallica.bnf.fr','Gallica')"><span class="qcard-icon">ğŸ“š</span><span class="qcard-name">Gallica</span></div>
          <div class="qcard" onclick="quickOpen('https://roglo.eu','Roglo')"><span class="qcard-icon">ğŸ°</span><span class="qcard-name">Roglo</span></div>
          <div class="qcard" onclick="quickOpen('https://www.persee.fr','PersÃ©e')"><span class="qcard-icon">ğŸ“</span><span class="qcard-name">PersÃ©e</span></div>
          <div class="qcard" onclick="quickOpen('https://monumentum.fr','Monumentum')"><span class="qcard-icon">ğŸ—¿</span><span class="qcard-name">Monumentum</span></div>
          <div class="qcard" onclick="quickOpen('https://www.familysearch.org/fr/','FamilySearch')"><span class="qcard-icon">ğŸ‘ª</span><span class="qcard-name">FamilySearch</span></div>
          <div class="qcard" onclick="quickOpen('https://www.retronews.fr','RetroNews')"><span class="qcard-icon">ğŸ—ï¸</span><span class="qcard-name">RetroNews</span></div>
          <div class="qcard" onclick="quickOpen('https://www.pop.culture.gouv.fr','Patrimoine')"><span class="qcard-icon">ğŸ›ï¸</span><span class="qcard-name">Patrimoine</span></div>
          <div class="qcard" onclick="quickOpen('https://www.filae.com','Filae')"><span class="qcard-icon">ğŸ“œ</span><span class="qcard-name">Filae</span></div>
          <div class="qcard" onclick="quickOpen('https://histoire-image.org','Hist.-Image')"><span class="qcard-icon">ğŸ–¼ï¸</span><span class="qcard-name">Hist. Image</span></div>
        </div>
      </div>

      <!-- â•â• RESULTS PANEL â•â• -->
      <div id="results-panel">

        <!-- Wikipedia info card -->
        <div id="info-card">
          <div id="info-card-img" class="placeholder">â³</div>
          <div class="info-card-body">
            <div class="info-loading show" id="info-loading"><span class="spinner"></span>Chargement de la ficheâ€¦</div>
            <div id="info-card-content" style="display:none">
              <div class="info-card-title" id="info-title"></div>
              <div class="info-card-meta" id="info-meta"></div>
              <div class="info-card-desc" id="info-desc"></div>
              <span class="info-card-link" id="info-wiki-link" onclick="openWikiPage()">ğŸ“– Voir la page WikipÃ©dia complÃ¨te â†’</span>
            </div>
          </div>
        </div>

        <!-- Results list -->
        <div id="results-list"></div>
      </div>

      <!-- â•â• VIEWER â•â• -->
      <div id="viewer-wrap">
        <div class="viewer-bar">
          <button class="vbtn" onclick="backToResults()">â† RÃ©sultats</button>
          <button class="vbtn" onclick="goHome()">ğŸ </button>
          <div class="viewer-url" id="viewer-url">â€”</div>
          <button class="vbtn" onclick="openViewerExternal()">â†— Ouvrir</button>
        </div>
        <div id="viewer-area">
          <div id="viewer-fallback">
            <div style="font-size:2.8rem">ğŸ”’</div>
            <h3>Ce site bloque l'affichage intÃ©grÃ©</h3>
            <p>Ce site utilise une protection <em>X-Frame-Options</em> qui empÃªche l'affichage dans un cadre. C'est courant sur les grands sites.</p>
            <div class="fb-actions">
              <button class="fb-btn" onclick="openViewerExternal()">â†— Ouvrir dans un nouvel onglet</button>
              <button class="fb-btn secondary" onclick="backToResults()">â† Retour aux rÃ©sultats</button>
            </div>
          </div>
          <iframe id="viewer"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox"
            src="about:blank" title="Visionneuse"></iframe>
        </div>
      </div>

    </div><!-- /content -->
  </main>
</div>

<div id="ad-container" aria-hidden="true"></div>
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG FILTRES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const enc = s => encodeURIComponent(s);

const FILTERS = {
  free: {
    label: 'ğŸŒ Recherche Libre',
    desc: 'Recherche sur tous les sites, rÃ©sultats directs avec description',
    sites: [] // handled specially
  },
  genealogy: {
    label: 'ğŸŒ³ GÃ©nÃ©alogie',
    desc: 'Geneanet Â· FamilySearch Â· Roglo Â· Geneall Â· Filae',
    sites: [
      { name:'Geneanet',     icon:'ğŸŒ³', desc:'Arbres gÃ©nÃ©alogiques et fiches personnes',
        search: q=>`https://www.geneanet.org/search/?q=${enc(q)}`,
        home:'https://www.geneanet.org', blocked:true },
      { name:'FamilySearch', icon:'ğŸ”', desc:'Base mondiale de documents d\'Ã©tat civil',
        search: q=>`https://www.familysearch.org/fr/search/record/results?q.anyScriptName=${enc(q)}`,
        home:'https://www.familysearch.org/fr/', blocked:false },
      { name:'Roglo',        icon:'ğŸ°', desc:'Base gÃ©nÃ©alogique ouverte, familles nobles',
        search: q=>`https://roglo.eu/roglo?lang=fr&m=S&n=${enc(q)}`,
        home:'https://roglo.eu', blocked:false },
      { name:'Geneall',      icon:'ğŸ”°', desc:'GÃ©nÃ©alogies nobiliaires et familles royales',
        search: q=>`https://www.geneall.net/fr/search/?q=${enc(q)}`,
        home:'https://www.geneall.net/fr/', blocked:false },
      { name:'Filae',        icon:'ğŸ“œ', desc:'Archives franÃ§aises numÃ©risÃ©es',
        search: q=>`https://www.filae.com/v4/fr/content/search.html#q=${enc(q)}`,
        home:'https://www.filae.com', blocked:true },
    ]
  },
  royal: {
    label: 'ğŸ‘‘ Familles Royales',
    desc: 'Roglo Â· Geneall Â· Wikipedia Â· CapÃ©tiens',
    sites: [
      { name:'Roglo',        icon:'ğŸ°', desc:'Arbres des familles royales europÃ©ennes',
        search: q=>`https://roglo.eu/roglo?lang=fr&m=S&n=${enc(q)}`,
        home:'https://roglo.eu', blocked:false },
      { name:'Geneall',      icon:'ğŸ”°', desc:'GÃ©nÃ©alogies des maisons royales',
        search: q=>`https://www.geneall.net/fr/search/?q=${enc(q)}`,
        home:'https://www.geneall.net/fr/', blocked:false },
      { name:'Wikipedia',    icon:'ğŸ“–', desc:'Articles encyclopÃ©diques sur les dynasties',
        search: q=>`https://fr.wikipedia.org/w/index.php?search=${enc(q)}&ns0=1`,
        home:'https://fr.wikipedia.org', blocked:false },
    ]
  },
  buildings: {
    label: 'ğŸ›ï¸ BÃ¢timents & Patrimoine',
    desc: 'Monumentum Â· POP Culture Â· MÃ©rimÃ©e Â· Wikipedia',
    sites: [
      { name:'Monumentum',  icon:'ğŸ—¿', desc:'Monuments historiques classÃ©s en France',
        search: q=>`https://monumentum.fr/recherche?q=${enc(q)}`,
        home:'https://monumentum.fr', blocked:false },
      { name:'POP Culture', icon:'ğŸ›ï¸', desc:'Plateforme ouverte du patrimoine culturel',
        search: q=>`https://www.pop.culture.gouv.fr/search?base=merimee&fq=${enc(q)}`,
        home:'https://www.pop.culture.gouv.fr', blocked:true },
      { name:'Wikipedia',   icon:'ğŸ“–', desc:'Articles sur chÃ¢teaux, cathÃ©drales, monuments',
        search: q=>`https://fr.wikipedia.org/w/index.php?search=${enc(q)}+bÃ¢timent&ns0=1`,
        home:'https://fr.wikipedia.org', blocked:false },
    ]
  },
  history: {
    label: 'ğŸ“œ Histoire',
    desc: 'Gallica Â· PersÃ©e Â· RetroNews Â· Histoire-Image Â· Archives Nationales',
    sites: [
      { name:'Gallica',        icon:'ğŸ“š', desc:'BibliothÃ¨que numÃ©rique de la BnF',
        search: q=>`https://gallica.bnf.fr/services/engine/search/sru?operation=searchRetrieve&version=1.2&query=(gallica+all+%22${enc(q)}%22)`,
        home:'https://gallica.bnf.fr', blocked:true },
      { name:'PersÃ©e',         icon:'ğŸ“', desc:'Revues scientifiques en sciences humaines',
        search: q=>`https://www.persee.fr/search#pa=1&q=${enc(q)}`,
        home:'https://www.persee.fr', blocked:false },
      { name:'RetroNews',      icon:'ğŸ—ï¸', desc:'Presse franÃ§aise ancienne numÃ©risÃ©e',
        search: q=>`https://www.retronews.fr/recherche?terms=${enc(q)}`,
        home:'https://www.retronews.fr', blocked:false },
      { name:'Histoire-Image', icon:'ğŸ–¼ï¸', desc:'Images et analyses historiques',
        search: q=>`https://histoire-image.org/etudes/search?q=${enc(q)}`,
        home:'https://histoire-image.org', blocked:false },
    ]
  },
  institutions: {
    label: 'âš–ï¸ Institutions',
    desc: 'AssemblÃ©e Nationale Â· SÃ©nat Â· Ã‰lysÃ©e Â· LÃ©gifrance',
    sites: [
      { name:'AssemblÃ©e Nat.', icon:'ğŸ›ï¸', desc:'DÃ©bats, lois, membres du Parlement',
        search: q=>`https://www.assemblee-nationale.fr/recherche?q=${enc(q)}`,
        home:'https://www.assemblee-nationale.fr', blocked:true },
      { name:'SÃ©nat',          icon:'âš–ï¸',  desc:'Textes lÃ©gislatifs et sÃ©nateurs',
        search: q=>`https://www.senat.fr/recherche/recherche.html?query=${enc(q)}`,
        home:'https://www.senat.fr', blocked:false },
      { name:'Ã‰lysÃ©e',         icon:'ğŸ‡«ğŸ‡·', desc:'PrÃ©sidence de la RÃ©publique franÃ§aise',
        search: q=>`https://www.elysee.fr/recherche?query=${enc(q)}`,
        home:'https://www.elysee.fr', blocked:false },
    ]
  }
};

// Recherche libre : liste de sites gÃ©nÃ©raux
const FREE_SITES = [
  { name:'DuckDuckGo',      icon:'ğŸ”', desc:'Moteur de recherche respectueux de la vie privÃ©e',
    search: q=>`https://duckduckgo.com/?q=${enc(q)}&kl=fr-fr`, blocked:false },
  { name:'Wikipedia FR',    icon:'ğŸ“–', desc:'EncyclopÃ©die libre et gratuite en franÃ§ais',
    search: q=>`https://fr.wikipedia.org/w/index.php?search=${enc(q)}&ns0=1`, blocked:false },
  { name:'Bing',            icon:'ğŸŒ', desc:'Moteur de recherche Microsoft',
    search: q=>`https://www.bing.com/search?q=${enc(q)}&setlang=fr`, blocked:true },
  { name:'Qwant',           icon:'ğŸ”µ', desc:'Moteur de recherche europÃ©en',
    search: q=>`https://www.qwant.com/?q=${enc(q)}&l=fr`, blocked:false },
  { name:'Gallica',         icon:'ğŸ“š', desc:'BibliothÃ¨que numÃ©rique nationale franÃ§aise',
    search: q=>`https://gallica.bnf.fr/services/engine/search/sru?operation=searchRetrieve&query=(gallica+all+%22${enc(q)}%22)`, blocked:true },
  { name:'PersÃ©e',          icon:'ğŸ“', desc:'Revues acadÃ©miques en sciences humaines',
    search: q=>`https://www.persee.fr/search#pa=1&q=${enc(q)}`, blocked:false },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentFilter = 'free';
let currentQuery  = '';
let currentViewerUrl = '';
let wikiPageUrl   = '';
let _blockTimer;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FILTRES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setFilter(key, _btn) {
  currentFilter = key;
  const f = FILTERS[key];
  document.querySelectorAll('.filter-btn').forEach(b => {
    b.classList.toggle('active', b.dataset.filter === key);
  });
  const lbl  = document.getElementById('filter-label-home');
  const desc = document.getElementById('filter-desc-home');
  if (lbl)  lbl.textContent  = f.label;
  if (desc) desc.textContent = f.desc;
  showToast('Filtre : ' + f.label);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RECHERCHE PRINCIPALE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doSearch(query) {
  query = (query || '').trim();
  if (!query) { showToast('Entrez un terme de recherche'); return; }

  currentQuery = query;
  document.getElementById('header-search').value = query;

  // Switch to results panel
  document.getElementById('home-screen').style.display = 'none';
  document.getElementById('viewer-wrap').classList.remove('active');
  const panel = document.getElementById('results-panel');
  panel.classList.add('show');

  // Reset
  document.getElementById('results-list').innerHTML = '';
  document.getElementById('info-card').className = '';
  showInfoLoading();

  // Fetch Wikipedia info card
  fetchWikipediaCard(query);

  // Build results
  const sites = currentFilter === 'free' ? FREE_SITES : FILTERS[currentFilter].sites;
  buildResultCards(query, sites);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WIKIPEDIA INFO CARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchWikipediaCard(query) {
  const card = document.getElementById('info-card');
  card.classList.add('show');

  try {
    // Search for the Wikipedia page
    const searchUrl = `https://fr.wikipedia.org/api/rest_v1/page/summary/${enc(query.replace(/ /g,'_'))}`;
    const res = await fetch(searchUrl);

    if (!res.ok) {
      // Try search fallback
      const searchRes = await fetch(`https://fr.wikipedia.org/w/api.php?action=query&list=search&srsearch=${enc(query)}&format=json&origin=*&srlimit=1`);
      const searchData = await searchRes.json();
      const title = searchData?.query?.search?.[0]?.title;
      if (!title) { hideInfoCard(); return; }
      const res2 = await fetch(`https://fr.wikipedia.org/api/rest_v1/page/summary/${enc(title)}`);
      if (!res2.ok) { hideInfoCard(); return; }
      const data = await res2.json();
      renderWikiCard(data);
    } else {
      const data = await res.json();
      renderWikiCard(data);
    }
  } catch(e) {
    hideInfoCard();
  }
}

function renderWikiCard(data) {
  document.getElementById('info-loading').classList.remove('show');
  document.getElementById('info-card-content').style.display = 'block';

  document.getElementById('info-title').textContent = data.title || '';
  document.getElementById('info-meta').textContent  = data.description || '';
  document.getElementById('info-desc').textContent  = data.extract || 'Aucune description disponible.';

  wikiPageUrl = data.content_urls?.desktop?.page || `https://fr.wikipedia.org/wiki/${enc(data.title || '')}`;
  document.getElementById('info-wiki-link').textContent = 'ğŸ“– Voir la page WikipÃ©dia complÃ¨te â†’';

  const img = document.getElementById('info-card-img');
  if (data.thumbnail?.source) {
    img.className = '';
    img.tagName === 'IMG'
      ? (img.src = data.thumbnail.source)
      : replaceImgEl(data.thumbnail.source);
  } else {
    img.className = 'placeholder';
    img.textContent = 'ğŸ›ï¸';
  }
}

function replaceImgEl(src) {
  const old = document.getElementById('info-card-img');
  const newImg = document.createElement('img');
  newImg.id = 'info-card-img';
  newImg.src = src;
  newImg.alt = 'Portrait';
  newImg.style.cssText = 'width:90px;height:110px;object-fit:cover;border-radius:3px;border:1px solid var(--border-strong);flex-shrink:0';
  old.parentNode.replaceChild(newImg, old);
}

function showInfoLoading() {
  document.getElementById('info-loading').classList.add('show');
  document.getElementById('info-card-content').style.display = 'none';
  const img = document.getElementById('info-card-img');
  img.className = 'placeholder';
  img.textContent = 'â³';
}

function hideInfoCard() {
  document.getElementById('info-card').classList.remove('show');
}

function openWikiPage() {
  if (wikiPageUrl) openInViewer(wikiPageUrl, 'Wikipedia â€” ' + currentQuery);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUILD RESULT CARDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildResultCards(query, sites) {
  const container = document.getElementById('results-list');
  container.innerHTML = '';

  const title = document.createElement('div');
  title.className = 'results-section-title';
  title.textContent = `RÃ©sultats pour "${query}" â€” ${sites.length} site${sites.length>1?'s':''} disponibles`;
  container.appendChild(title);

  sites.forEach(site => {
    const searchUrl = site.search(query);
    const card = document.createElement('div');
    card.className = 'result-card';

    const isBlocked = site.blocked;

    card.innerHTML = `
      <span class="result-card-icon">${site.icon}</span>
      <div class="result-card-body">
        <div class="result-card-title">${site.name}</div>
        <div class="result-card-url">${searchUrl}</div>
        <div class="result-card-desc">${site.desc}</div>
        <div class="result-card-actions">
          ${!isBlocked
            ? `<button class="raction primary" onclick="openInViewer('${esc(searchUrl)}','${esc(site.name)}')">ğŸ” Voir les rÃ©sultats</button>`
            : `<button class="raction" onclick="openInViewer('${esc(searchUrl)}','${esc(site.name)}')">ğŸ” Essayer en intÃ©grÃ©</button>`
          }
          <button class="raction" onclick="window.open('${esc(searchUrl)}','_blank','noopener,noreferrer')">â†— Ouvrir dans un onglet</button>
          ${isBlocked ? `<span style="font-size:.6rem;color:var(--red);letter-spacing:.06em;align-self:center">âš ï¸ Ce site bloque souvent l'intÃ©gration</span>` : ''}
        </div>
      </div>`;
    container.appendChild(card);
  });

  // Wikipedia direct link always shown
  if (currentFilter !== 'free') {
    const wikiUrl = `https://fr.wikipedia.org/w/index.php?search=${enc(query)}&ns0=1`;
    addExtraCard(container, 'ğŸ“–', 'Wikipedia', wikiUrl, 'EncyclopÃ©die libre en franÃ§ais â€” toujours disponible', false);
  }
}

function addExtraCard(container, icon, name, url, desc, blocked) {
  const card = document.createElement('div');
  card.className = 'result-card';
  card.innerHTML = `
    <span class="result-card-icon">${icon}</span>
    <div class="result-card-body">
      <div class="result-card-title">${name}</div>
      <div class="result-card-url">${url}</div>
      <div class="result-card-desc">${desc}</div>
      <div class="result-card-actions">
        <button class="raction primary" onclick="openInViewer('${esc(url)}','${esc(name)}')">ğŸ” Voir les rÃ©sultats</button>
        <button class="raction" onclick="window.open('${esc(url)}','_blank','noopener,noreferrer')">â†— Ouvrir dans un onglet</button>
      </div>
    </div>`;
  container.appendChild(card);
}

function esc(s) { return s.replace(/'/g, "\\'"); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VIEWER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openInViewer(url, label) {
  currentViewerUrl = url;
  document.getElementById('results-panel').classList.remove('show');
  document.getElementById('viewer-wrap').classList.add('active');
  document.getElementById('viewer-url').textContent = label || url;

  const viewer   = document.getElementById('viewer');
  const fallback = document.getElementById('viewer-fallback');
  fallback.classList.remove('show');
  viewer.style.display = 'block';

  clearTimeout(_blockTimer);
  viewer.src = url;

  viewer.onload = function() {
    try {
      const loc = viewer.contentWindow.location.href;
      if (!loc || loc === 'about:blank') showViewerFallback();
      clearTimeout(_blockTimer);
    } catch(e) { clearTimeout(_blockTimer); /* cross-origin = ok */ }
  };
  _blockTimer = setTimeout(() => {
    try {
      const loc = viewer.contentWindow.location.href;
      if (!loc || loc === 'about:blank') showViewerFallback();
    } catch(e) {}
  }, 7000);
}

function showViewerFallback() {
  document.getElementById('viewer').style.display = 'none';
  document.getElementById('viewer-fallback').classList.add('show');
}

function backToResults() {
  clearTimeout(_blockTimer);
  document.getElementById('viewer').src = 'about:blank';
  document.getElementById('viewer-fallback').classList.remove('show');
  document.getElementById('viewer').style.display = 'block';
  document.getElementById('viewer-wrap').classList.remove('active');
  if (currentQuery) document.getElementById('results-panel').classList.add('show');
  else goHome();
}

function openViewerExternal() {
  if (currentViewerUrl) window.open(currentViewerUrl, '_blank', 'noopener,noreferrer');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OPEN SITE DIRECT (sidebar / raccourcis)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function quickOpen(url, name) {
  currentViewerUrl = url;
  currentQuery = '';
  document.getElementById('home-screen').style.display = 'none';
  document.getElementById('results-panel').classList.remove('show');
  openInViewer(url, name);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goHome() {
  clearTimeout(_blockTimer);
  document.getElementById('viewer').src = 'about:blank';
  document.getElementById('viewer-fallback').classList.remove('show');
  document.getElementById('viewer').style.display = 'block';
  document.getElementById('viewer-wrap').classList.remove('active');
  document.getElementById('results-panel').classList.remove('show');
  document.getElementById('home-screen').style.display = 'flex';
  currentQuery = ''; currentViewerUrl = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TÃ‰LÃ‰CHARGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function downloadApp() {
  const html = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
  const blob = new Blob([html], {type:'text/html;charset=utf-8'});
  const url  = URL.createObjectURL(blob);
  const a    = Object.assign(document.createElement('a'), {href:url, download:'ArchivesPortail.html'});
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showToast('â¬‡ TÃ©lÃ©chargement dÃ©marrÃ© !');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _tt;
function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(_tt); _tt = setTimeout(() => el.classList.remove('show'), 2400);
}

document.addEventListener('DOMContentLoaded', () => document.getElementById('home-search').focus());
</script>
</body>
</html>
